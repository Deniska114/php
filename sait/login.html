<main class="login-page">
    <h2>Вітаємо в Coffee Lover</h2>

    <div id="message" style="display: none; padding: 10px; margin: 10px 0; border-radius: 5px;"></div>

    <form id="loginForm">
        <h3>Авторизація</h3>
        <label for="email">Email</label>
        <input type="email" id="email" name="email" placeholder="you@example.com" required>
        <div id="emailError" class="error"></div>

        <label for="password">Пароль</label>
        <input type="password" id="password" name="password" placeholder="••••••••" required>
        <div id="passwordError" class="error"></div>

        <p>
            <a href="https://i.ytimg.com/vi/OPCmEN26hoI/maxresdefault.jpg">Забули пароль?</a>
            |
            <a href="#" id="showRegister">Зареєструватись</a>
            |
            <a href="/?page=home">Назад</a>
        </p>

        <button type="submit">Увійти</button>
    </form>

    <form id="registerForm" style="display: none;">
        <h3>Реєстрація</h3>
        <label for="regName">Ім'я</label>
        <input type="text" id="regName" name="name" placeholder="Ваше ім'я" required>
        <div id="regNameError" class="error"></div>

        <label for="regEmail">Email</label>
        <input type="email" id="regEmail" name="email" placeholder="you@example.com" required>
        <div id="regEmailError" class="error"></div>

        <label for="regPassword">Пароль</label>
        <input type="password" id="regPassword" name="password" placeholder="Мінімум 6 символів" required>
        <div id="regPasswordError" class="error"></div>

        <p>
            <a href="#" id="showLogin">Вже маєте акаунт? Увійти</a>
            |
            <a href="/?page=home">Назад</a>
        </p>

        <button type="submit">Зареєструватись</button>
    </form>
</main>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const loginForm = document.getElementById('loginForm');
    const registerForm = document.getElementById('registerForm');
    const showRegister = document.getElementById('showRegister');
    const showLogin = document.getElementById('showLogin');
    const messageDiv = document.getElementById('message');

    function escapeHtml(text) {
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
    }

    function showMessage(text, isError = false) {
        messageDiv.textContent = text;
        messageDiv.style.display = 'block';
        messageDiv.style.backgroundColor = isError ? '#ffebee' : '#e8f5e9';
        messageDiv.style.color = isError ? '#c62828' : '#2e7d32';
        setTimeout(() => {
            messageDiv.style.display = 'none';
        }, 5000);
    }

    showRegister.addEventListener('click', function(e) {
        e.preventDefault();
        loginForm.style.display = 'none';
        registerForm.style.display = 'block';
    });

    showLogin.addEventListener('click', function(e) {
        e.preventDefault();
        registerForm.style.display = 'none';
        loginForm.style.display = 'block';
    });

    loginForm.addEventListener('submit', function(e) {
        e.preventDefault();
        
        const email = document.getElementById('email').value.trim();
        const password = document.getElementById('password').value;

        const formData = new FormData();
        formData.append('action', 'login');
        formData.append('email', email);
        formData.append('password', password);

        fetch('auth_handler.php', {
            method: 'POST',
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                showMessage('Авторизація успішна!', false);
                setTimeout(() => {
                    window.location.href = '/?page=home';
                }, 1500);
            } else {
                showMessage(data.message || 'Помилка авторизації', true);
            }
        })
        .catch(error => {
            showMessage('Помилка з\'єднання з сервером', true);
        });
    });

    registerForm.addEventListener('submit', function(e) {
        e.preventDefault();
        
        const name = document.getElementById('regName').value.trim();
        const email = document.getElementById('regEmail').value.trim();
        const password = document.getElementById('regPassword').value;

        const formData = new FormData();
        formData.append('action', 'register');
        formData.append('name', name);
        formData.append('email', email);
        formData.append('password', password);

        fetch('auth_handler.php', {
            method: 'POST',
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                showMessage('Реєстрація успішна! Тепер ви можете увійти.', false);
                setTimeout(() => {
                    registerForm.style.display = 'none';
                    loginForm.style.display = 'block';
                }, 2000);
            } else {
                showMessage(data.message || 'Помилка реєстрації', true);
            }
        })
        .catch(error => {
            showMessage('Помилка з\'єднання з сервером', true);
        });
    });
});
</script>